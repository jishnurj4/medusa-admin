var ye=Object.defineProperty;var s=(e,t)=>ye(e,"name",{value:t,configurable:!0}),S=(e=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(t,o)=>(typeof require<"u"?require:t)[o]}):e)(function(e){if(typeof require<"u")return require.apply(this,arguments);throw new Error('Dynamic require of "'+e+'" is not supported')});var N=["/products","/products/:id","/product-categories","/product-categories","/orders","/orders/:id","/customers","/customers/:id","/customers/groups","/customers/groups/:id","/discounts","/discounts/new","/discounts/:id","/gift-cards","/gift-cards/:id","/gift-cards/manage","/pricing","/pricing/new","/pricing/:id","/inventory","/collections","/collections/:id","/draft-orders","/draft-orders/:id","/login","/sales-channels","/publishable-api-keys","/oauth","/oauth/:app_name"];var V=["order.details.before","order.details.after","order.list.before","order.list.after","draft_order.list.before","draft_order.list.after","draft_order.details.before","draft_order.details.after","customer.details.before","customer.details.after","customer.list.before","customer.list.after","customer_group.details.before","customer_group.details.after","customer_group.list.before","customer_group.list.after","product.details.before","product.details.after","product.list.before","product.list.after","product_collection.details.before","product_collection.details.after","product_collection.list.before","product_collection.list.after","price_list.details.before","price_list.details.after","price_list.list.before","price_list.list.after","discount.details.before","discount.details.after","discount.list.before","discount.list.after","gift_card.details.before","gift_card.details.after","gift_card.list.before","gift_card.list.after","custom_gift_card.before","custom_gift_card.after","login.before","login.after"];import X from"node:path";import Je from"webpack";import Ie from"fs-extra";import G from"node:path";import Z from"fs-extra";function j(e){return!(Z.lstatSync(e).isDirectory()&&e.includes("__test__")||Z.lstatSync(e).isFile()&&(e.includes(".test")||e.includes(".spec")||e.includes("webpack.config")))}s(j,"copyFilter");import E from"fs-extra";import m from"node:path";import T from"ts-dedent";import b from"picocolors";import Q from"readline";var U="[@medusajs/admin]";function we(){let e=process.stdout.rows-2,t=e>0?`
`.repeat(e):"";console.log(t),Q.cursorTo(process.stdout,0,0),Q.clearScreenDown(process.stdout)}s(we,"clearScreen");var xe=process.stdout.isTTY&&!process.env.CI,be=xe?we:()=>{};function Ee(){let e=s((t,o,r)=>{let n=t==="info"?"log":t,a=s(()=>{let i=t==="info"?b.cyan(b.bold(U)):t==="warn"?b.yellow(b.bold(U)):b.red(b.bold(U));return`${b.dim(new Date().toLocaleTimeString())} ${i} ${o}`},"format");r!=null&&r.clearScreen&&be(),console[n](a()),r!=null&&r.error&&console.error(r.error)},"output");return{info:(t,o)=>e("info",t,o),warn:(t,o)=>e("warn",t,o),error:(t,o)=>e("error",t,o),panic:(t,o)=>{e("error",t,o),e("error","Exiting process",{}),process.exit(1)}}}s(Ee,"createLogger");var l=Ee();function y(e){let o=process.platform==="win32"?"\\":"/",r=new RegExp(`\\${o}`,"g");return e.replace(r,"/")}s(y,"normalizePath");import{parse as O}from"@babel/parser";import _ from"@babel/traverse";import g from"fs-extra";import P from"path";function Y(e){return V.includes(e)}s(Y,"isValidInjectionZone");function $e(e){let t=e.find(r=>r.type==="ObjectProperty"&&r.key.type==="Identifier"&&r.key.name==="zone");if(!t)return!1;let o=!1;return t.value.type==="StringLiteral"?o=Y(t.value.value):t.value.type==="ArrayExpression"&&(o=t.value.elements.every(r=>r.type==="StringLiteral"&&Y(r.value))),o}s($e,"validateWidgetConfigExport");function Se(e){let t=e.find(n=>n.type==="ObjectProperty"&&n.key.type==="Identifier"&&n.key.name==="link");if(!t)return!0;let o=t.value,r=!1;return o.properties.some(n=>n.type==="ObjectProperty"&&n.key.type==="Identifier"&&n.key.name==="label"&&n.value.type==="StringLiteral")&&(r=!0),r}s(Se,"validateRouteConfigExport");function _e(e){let t=e.find(a=>a.type==="ObjectProperty"&&a.key.type==="Identifier"&&a.key.name==="card");if(!t)return!1;let o=t.value,r=!1,n=!1;return o.properties.some(a=>a.type==="ObjectProperty"&&a.key.type==="Identifier"&&a.key.name==="label"&&a.value.type==="StringLiteral")&&(r=!0),o.properties.some(a=>a.type==="ObjectProperty"&&a.key.type==="Identifier"&&a.key.name==="description"&&a.value.type==="StringLiteral")&&(n=!0),r&&n}s(_e,"validateSettingConfigExport");function M(e,t){let o=!1,r=e.node.declaration;if(r&&r.type==="VariableDeclaration"){let n=r.declarations.find(a=>a.type==="VariableDeclarator"&&a.id.type==="Identifier"&&a.id.name==="config");if(n&&n.init.type==="ObjectExpression"){let a=n.init.properties;t==="widget"&&(o=$e(a)),t==="route"&&(o=Se(a)),t==="setting"&&(o=_e(a))}else o=!1}return o}s(M,"validateConfigExport");function z(e,t){let o=!1,r=e.node.declaration;if(r&&(r.type==="Identifier"||r.type==="FunctionDeclaration")){let n=r.type==="Identifier"?r.name:r.id&&r.id.name;if(n)try{_(t,{VariableDeclarator({node:a,scope:i}){let d=!1;a.id.type==="Identifier"&&a.id.name===n&&(d=!0),d&&_(a,{ReturnStatement(f){var u,c;(((u=f.node.argument)==null?void 0:u.type)==="JSXElement"||((c=f.node.argument)==null?void 0:c.type)==="JSXFragment")&&(o=!0)}},i)}})}catch(a){return l.error(`There was an error while validating the default export of ${e}. The following error must be resolved before continuing:`,{error:a}),!1}}return o}s(z,"validateDefaultExport");async function ee(e){let t=await g.readFile(e,"utf-8"),o={sourceType:"module",plugins:["jsx"]};(e.endsWith(".ts")||e.endsWith(".tsx"))&&o.plugins.push("typescript");let r;try{r=O(t,o)}catch(i){return l.error(`An error occurred while parsing the Widget "${e}", and the Widget cannot be injected. The following error must be resolved before continuing:`,{error:i}),!1}let n=!1,a=!1;try{_(r,{ExportDefaultDeclaration:i=>{a=z(i,r)},ExportNamedDeclaration:i=>{n=M(i,"widget")}})}catch(i){return l.error(`An error occurred while validating the Widget "${e}". The following error must be resolved before continuing:`,{error:i}),!1}return n&&!a&&(a||l.error(`The default export in the Widget "${e}" is invalid and the widget will not be injected. Please make sure that the default export is a valid React component.`)),!n&&a&&l.error(`The Widget config export in "${e}" is invalid and the Widget cannot be injected. Please ensure that the config is valid.`),n&&a}s(ee,"validateWidget");function te(e){let t=y(e),o=/\[(.*?)\]/g;return t.replace(o,":$1").replace(/\/page\.[jt]sx?$/i,"")}s(te,"createPath");function ke(e){return N.includes(e)}s(ke,"isForbiddenRoute");function re(e,t){if(ke(e))return{error:`A route from ${t} is using a forbidden path: ${e}.`,valid:!1};let o=["/",":","-"];for(let r=0;r<e.length;r++){let n=e[r];if(!o.includes(n)&&!/^[a-z0-9]$/i.test(n))return{error:`A route from ${t} is using an invalid path: ${e}. Only alphanumeric characters, "/", ":", and "-" are allowed.`,valid:!1};if(n===":"&&(r===0||e[r-1]!=="/"))return{error:`A route from ${t} is using an invalid path: ${e}. All dynamic segments must be preceded by a "/".`,valid:!1}}return{valid:!0,error:""}}s(re,"validatePath");async function oe(e,t){let o=te(e.replace(t,"")),{valid:r,error:n}=re(o,e);if(!r)return l.error(`The path ${o} for the UI Route "${e}" is invalid and the route cannot be injected. The following error must be fixed before the route can be injected: ${n}`),null;let a=await g.readFile(e,"utf-8"),i=!1,d=!1,f={sourceType:"module",plugins:["jsx"]};(e.endsWith(".ts")||e.endsWith(".tsx"))&&f.plugins.push("typescript");let u;try{u=O(a,f)}catch(c){return l.error(`An error occurred while parsing the UI Route "${e}", and the UI Route cannot be injected. The following error must be resolved before continuing:`,{error:c}),null}try{_(u,{ExportDefaultDeclaration:c=>{i=z(c,u)},ExportNamedDeclaration:c=>{d=M(c,"route")}})}catch(c){return l.error(`An error occurred while validating the UI Route "${e}", and the UI Route cannot be injected. The following error must be resolved before continuing:`,{error:c}),null}return i?{path:o,hasConfig:d,file:e}:(l.error(`The default export in the UI Route "${e}" is invalid and the route cannot be injected. Please make sure that the default export is a valid React component.`),null)}s(oe,"validateRoute");async function ne(e,t){let o=te(e.replace(t,"")),{valid:r,error:n}=re(o,e);if(!r)return l.error(`The path ${o} for the Setting "${e}" is invalid and the setting cannot be injected. The following error must be fixed before the Setting can be injected: ${n}`),null;let a=await g.readFile(e,"utf-8"),i=!1,d=!1,f={sourceType:"module",plugins:["jsx"]};(e.endsWith(".ts")||e.endsWith(".tsx"))&&f.plugins.push("typescript");let u;try{u=O(a,f)}catch(c){return l.error(`
      An error occured while parsing the Setting "${e}". The following error must be resolved before continuing:
      `,{error:c}),null}try{_(u,{ExportDefaultDeclaration:c=>{i=z(c,u)},ExportNamedDeclaration:c=>{d=M(c,"setting")}})}catch(c){return l.error(`
      An error occured while validating the Setting "${e}". The following error must be resolved before continuing:`,{error:c}),null}return i?d?{path:o,file:e}:(l.error(`The named export "config" in the Setting "${e}" is invalid or missing and the settings page will not be injected. Please make sure that the file exports a valid config.`),null):(l.error(`The default export in the Setting "${e}" is invalid and the page will not be injected. Please make sure that the default export is a valid React component.`),null)}s(ne,"validateSetting");async function D(e){let t=[];if(!await g.pathExists(e))return[];let r=await g.readdir(e),n=!1;for(let i of r){let d=P.join(e,i);if((await g.stat(d)).isDirectory()){let u=await g.readdir(d);for(let c of u){let v=P.join(e,i,c),x=await g.stat(v);if(x.isFile()&&/^(.*\/)?page\.[jt]sx?$/i.test(c)){t.push(v);break}else x.isDirectory()&&(n=!0)}}}return n&&l.warn(`The directory ${e} contains subdirectories. Settings do not support nested routes, only UI Routes support nested paths.`),(await Promise.all(t.map(async i=>ne(i,e)))).filter(i=>i!==null)}s(D,"findAllValidSettings");async function I(e){let t=[];if(!await g.pathExists(e))return[];async function r(i){let d=await g.readdir(i);for(let f of d){let u=P.join(i,f),c=await g.stat(u);c.isDirectory()?await r(u):c.isFile()&&/\.(js|jsx|ts|tsx)$/i.test(f)&&t.push(u)}}s(r,"traverseDirectory"),await r(e);let n=t.map(i=>ee(i)?i:null);return(await Promise.all(n)).filter(i=>i!==null)}s(I,"findAllValidWidgets");async function W(e){let t=[];if(!await g.pathExists(e))return[];async function r(i){let d=await g.readdir(i);for(let f of d){let u=P.join(i,f),c=await g.stat(u);c.isDirectory()?await r(u):c.isFile()&&/^(.*\/)?page\.[jt]sx?$/i.test(f)&&t.push(u)}}s(r,"traverseDirectory"),await r(e);let n=t.map(async i=>oe(i,e));return(await Promise.all(n)).filter(i=>i!==null)}s(W,"findAllValidRoutes");var F=/\.[^/.]+$/;async function Ce(e,t){if(process.env.PLUGIN_ADMIN_UI_SKIP_CACHE)return!0;try{await E.copy(e,t,{filter:j})}catch(o){return l.error("Could not copy local extensions to cache folder. See the error below for details:",{error:o}),!1}return!0}s(Ce,"copyLocalExtensions");async function Ae(e,t){let o=m.resolve(e,"src","admin");if(!await E.pathExists(o))return!1;if(!await Ce(o,m.resolve(t,"admin","src","extensions")))return l.error("Could not copy local extensions to cache folder. See above error for details. The error must be fixed before any local extensions can be injected."),!1;let[a,i,d]=await Promise.all([I(m.resolve(t,"admin","src","extensions","widgets")),W(m.resolve(t,"admin","src","extensions","routes")),D(m.resolve(t,"admin","src","extensions","settings"))]),f=a.map((p,h)=>{let w=y(m.relative(m.resolve(t,"admin","src","extensions"),p).replace(F,""));return{importStatement:`import Widget${h}, { config as widgetConfig${h} } from "./${w}"`,extension:`{ Component: Widget${h}, config: { ...widgetConfig${h}, type: "widget" } }`}}),u=i.map((p,h)=>{let w=y(m.relative(m.resolve(t,"admin","src","extensions"),p.file).replace(F,"")),ge=p.hasConfig?`import Page${h}, { config as routeConfig${h} } from "./${w}"`:`import Page${h} from "./${w}"`,ve=p.hasConfig?`{ Component: Page${h}, config: { ...routeConfig${h}, type: "route",  path: "${p.path}" } }`:`{ Component: Page${h}, config: { path: "${p.path}", type: "route" } }`;return{importStatement:ge,extension:ve}}),c=d.map((p,h)=>{let w=y(m.relative(m.resolve(t,"admin","src","extensions"),p.file).replace(F,""));return{importStatement:`import Setting${h}, { config as settingConfig${h} } from "./${w}"`,extension:`{ Component: Setting${h}, config: { ...settingConfig${h}, path: "${p.path}", type: "setting" } }`}}),v=[...f,...u,...c],x=T`
    ${v.map(p=>p.importStatement).join(`
`)}

    const LocalEntry = {
      identifier: "local",
      extensions: [
        ${v.map(p=>p.extension).join(`,
`)}
      ],
    }

    export default LocalEntry
  `;try{await E.outputFile(m.resolve(t,"admin","src","extensions","_local-entry.ts"),x)}catch(p){l.panic("Failed to write the entry file for the local extensions. See the error below for details:",{error:p})}return!0}s(Ae,"createLocalExtensionsEntry");function je(e){let t=[];for(let o of e)try{let r=m.dirname(S.resolve(`${o}/package.json`,{paths:[process.cwd()]})),n=m.resolve(r,"dist","admin","_virtual_entry.js");E.existsSync(n)&&t.push(n)}catch{l.warn(`There was an error while attempting to load extensions from the plugin: ${o}. Are you sure it is installed?`)}return t}s(je,"findPluginsWithExtensions");async function Pe(e,t){let o=T`
    const path = require("path")

    const devPath = path.join(__dirname, "..", "..", "src/admin/**/*.{js,jsx,ts,tsx}")

    module.exports = {
      content: [
        devPath,
        ${t.map(r=>`"${y(m.relative(m.resolve(e,"admin"),m.dirname(m.join(r,"..",".."))))}/dist/admin/**/*.{js,jsx,ts,tsx}"`).join(`,
`)}
      ],
    }
  
  `;try{await E.outputFile(m.resolve(e,"admin","tailwind.content.js"),o)}catch{l.warn(`Failed to write the Tailwind content file to ${e}. The admin UI will remain functional, but CSS classes applied to extensions from plugins might not have the correct styles`)}}s(Pe,"writeTailwindContentFile");async function De(e,t,o){if(!t.length&&!o){let i=T`
      const extensions = []

      export default extensions
    `;try{await E.outputFile(m.resolve(e,"admin","src","extensions","_main-entry.ts"),i)}catch(d){l.panic("Failed to write the entry file for the main extensions. See the error below for details:",{error:d})}return}let n=[...t.map(i=>y(m.relative(m.resolve(e,"admin","src","extensions"),i).replace(F,""))).map((i,d)=>({importStatement:`import Plugin${d} from "${i}"`,extension:`Plugin${d}`})),...o?[{importStatement:'import LocalEntry from "./_local-entry"',extension:"LocalEntry"}]:[]],a=T`
      ${n.map(i=>i.importStatement).join(`
`)}

      const extensions = [
        ${n.map(i=>i.extension).join(`,
`)}
      ]

      export default extensions
    `;try{await E.outputFile(m.resolve(e,"admin","src","extensions","_main-entry.ts"),a)}catch(i){l.panic("Failed to write the extensions entry file. See the error below for details:",{error:i})}}s(De,"createMainExtensionsEntry");async function R({appDir:e,dest:t,plugins:o}){let r=await Ae(e,t),n=je(o);await De(t,n,r),await Pe(t,n)}s(R,"createEntry");async function We(e){if(process.env.PLUGIN_ADMIN_UI_SKIP_CACHE)return!0;let t=G.resolve(__dirname,"..","ui"),o=G.resolve(e,"admin");try{await Ie.copy(t,o,{filter:j})}catch(r){l.panic(`Could not copy the admin UI to ${o}. See the error below for details:`,{error:r})}}s(We,"copyAdmin");async function k({appDir:e,plugins:t}){let o=G.resolve(e,".cache");return await We(o),await R({appDir:e,dest:o,plugins:t}),{cacheDir:o}}s(k,"createCacheDir");import ie from"dotenv";import Fe from"fs-extra";import ae from"node:path";var Te=/^MEDUSA_ADMIN_/i,$="";switch(process.env.NODE_ENV){case"production":$=".env.production";break;case"staging":$=".env.staging";break;case"test":$=".env.test";break;case"development":default:$=".env";break}Fe.existsSync($)?ie.config({path:ae.resolve(process.cwd(),$)}):$!==".env"&&ie.config({path:ae.resolve(process.cwd(),".env")});var H=s(e=>{let t=Object.keys(process.env).filter(r=>Te.test(r)).reduce((r,n)=>(r[n]=process.env[n],r),{ADMIN_PATH:e.path||"/",NODE_ENV:e.env||"development",MEDUSA_BACKEND_URL:e.backend||process.env.MEDUSA_BACKEND_URL});return{"process.env":Object.keys(t).reduce((r,n)=>(r[n]=JSON.stringify(t[n]),r),{})}},"getClientEnv");import Re from"chokidar";import Le from"fs-extra";import C from"node:path";async function K(e,t,o){let r=C.resolve(e,"src","admin"),n=Re.watch(r,{ignored:/(^|[/\\])\../,ignoreInitial:!0});n.on("all",async(a,i)=>{(a==="unlinkDir"||a==="unlink")&&Ne(i,e,t),await R({appDir:e,dest:t,plugins:o}),l.info("Extensions cache directory was re-initialized")}),process.on("SIGINT",async()=>{await n.close()}).on("SIGTERM",async()=>{await n.close()})}s(K,"watchLocalAdminFolder");function Ne(e,t,o){let r=C.resolve(t,"src","admin"),n=C.relative(r,e),a=C.resolve(o,"admin","src","extensions"),i=C.resolve(a,n);try{Le.removeSync(i)}catch(d){l.error(`An error occurred while removing ${i}: ${d}`)}}s(Ne,"removeUnlinkedFile");import Ke from"fs-extra";import qe from"node:path";import Be from"webpack";function se(e){let{options:t}=e;t.path&&(t.path.startsWith("/")||l.panic("'path' in the options of `@medusajs/admin` must start with a '/'"),t.path!=="/"&&t.path.endsWith("/")&&l.panic("'path' in the options of `@medusajs/admin` cannot end with a '/'"),typeof t.path!="string"&&l.panic("'path' in the options of `@medusajs/admin` must be a string"))}s(se,"validateArgs");import Ve from"@pmmmwh/react-refresh-webpack-plugin";import Ue from"copy-webpack-plugin";import Oe from"html-webpack-plugin";import B from"mini-css-extract-plugin";import L from"node:path";import{SwcMinifyWebpackPlugin as Me}from"swc-minify-webpack-plugin";import ze from"webpack";import Ge from"webpackbar";var q=["react","react-dom","react-router-dom","react-dnd","react-dnd-html5-backend","react-select","react-helmet-async","@tanstack/react-query","@tanstack/react-table","@emotion/react","medusa-react","@medusajs/ui","@medusajs/icons","@medusajs/ui-preset"];var le=q.reduce((e,t)=>(e[`${t}$`]=S.resolve(t),e),{});function He(e){return e?e==="/"||e.endsWith("/")?e:`${e}/`:"/app/"}s(He,"formatPublicPath");function J({entry:e,dest:t,cacheDir:o,env:r,options:n,template:a,publicFolder:i,reporting:d="fancy"}){let f=r==="production",u=H({env:r,backend:n==null?void 0:n.backend,path:n==null?void 0:n.path}),c=He(n==null?void 0:n.path),v=f?[new B({filename:"[name].[chunkhash].css",chunkFilename:"[name].[chunkhash].css"}),new Ge({basic:d==="minimal",fancy:d==="fancy"})]:[new B,new Ve];return{mode:r,devtool:f?!1:"inline-source-map",entry:[e],output:{path:t,filename:f?"[name].[contenthash:8].js":"[name].bundle.js",chunkFilename:f?"[name].[contenthash:8].chunk.js":"[name].chunk.js"},optimization:{minimize:!0,minimizer:[new Me],moduleIds:"deterministic",runtimeChunk:!0},module:{rules:[{test:/\.tsx?$/,exclude:/node_modules/,include:[o],use:{loader:"swc-loader",options:{jsc:{parser:{syntax:"typescript",jsx:!0},transform:{react:{runtime:"automatic",development:!f,refresh:!f}}}}}},{test:/\.jsx?$/,exclude:/node_modules/,include:[o],use:{loader:"swc-loader",options:{jsc:{parser:{syntax:"ecmascript",jsx:!0},transform:{react:{runtime:"automatic"}}}}}},{test:/\.css$/,use:[B.loader,"css-loader","postcss-loader"]},{test:/\.svg$/,oneOf:[{type:"asset/resource",resourceQuery:/url/},{type:"asset/inline",resourceQuery:/base64/},{issuer:/\.[jt]sx?$/,use:["@svgr/webpack"]}],generator:{filename:`images/${f?"[name]-[hash][ext]":"[name][ext]"}`}},{test:/\.(eot|otf|ttf|woff|woff2)$/,type:"asset/resource"},{test:/\.m?jsx?$/,resolve:{fullySpecified:!1}}]},resolve:{alias:le,symlinks:!1,extensions:[".js",".jsx",".ts",".tsx"],mainFields:["browser","module","main"],modules:["node_modules",L.resolve(__dirname,"..","node_modules")],fallback:{readline:!1,path:!1}},plugins:[new Oe({inject:!0,template:a||L.resolve(__dirname,"..","ui","index.html"),publicPath:c}),new ze.DefinePlugin(u),new Ue({patterns:[{from:i||L.resolve(__dirname,"..","ui","public"),to:L.resolve(t,"public")}]}),...v].filter(Boolean),stats:f?"errors-only":"errors-warnings"}}s(J,"getWebpackConfig");async function A(e,t){se(t);let o=J(t),r=qe.join(e,"src","admin","webpack.config.js");if(await Ke.pathExists(r)){let a;try{a=S(r)}catch(i){l.panic("An error occured while trying to load your custom Webpack config. See the error below for details:",{error:i})}typeof a=="function"&&(t.devServer&&(o.devServer=t.devServer),o=a(o,Be),o||l.panic("Nothing was returned from your custom webpack configuration"))}return o}s(A,"getCustomWebpackConfig");function ce(e){return(t,o)=>e(t,o)}s(ce,"withCustomWebpackConfig");async function de({appDir:e,buildDir:t,plugins:o,options:r,reporting:n="fancy"}){process.env.PLUGIN_ADMIN_UI_SKIP_CACHE||await k({appDir:e,plugins:o});let a=X.resolve(e,".cache"),i=X.resolve(a,"admin","src","main.tsx"),d=X.resolve(e,t),u=await A(e,{entry:i,dest:d,cacheDir:a,env:"production",options:r,reporting:n}),c=Je(u);return new Promise((v,x)=>{c.run((p,h)=>{p&&(p.details&&l.error(p.details),x(p));let w=h.toJson();return h.hasErrors()&&l.error(JSON.stringify(w.errors)),v({stats:h,warnings:w.warnings})})})}s(de,"build");import fe from"fs-extra";import ue from"node:path";async function pe({appDir:e,outDir:t}){let o=ue.resolve(e,".cache","admin"),r=ue.resolve(e,t);await fe.remove(r),await fe.remove(o)}s(pe,"clean");import me from"node:path";import Xe from"react-dev-utils/openBrowser";import Ze from"webpack";import Qe from"webpack-dev-server";async function he({appDir:e,buildDir:t,plugins:o,options:r={path:"/",backend:"http://localhost:9000",develop:{open:!0,port:7001,host:"localhost",logLevel:"error",stats:"normal",allowedHosts:"auto"}}}){let{cacheDir:n}=await k({appDir:e,plugins:o}),a=me.resolve(n,"admin","src","main.tsx"),i=me.resolve(e,t),f=await A(e,{entry:a,dest:i,cacheDir:n,env:"development",options:r}),u=Ze({...f,infrastructureLogging:{level:r.develop.logLevel},stats:r.develop.stats==="normal"?"errors-only":void 0}),c={port:r.develop.port,host:r.develop.host,client:{logging:"none",overlay:{errors:!0,warnings:!1},webSocketURL:r.develop.webSocketURL?r.develop.webSocketURL:`ws://${r.develop.host}:${r.develop.port}/ws`},open:!1,onListening:r.develop.open?function(p){p||l.warn("Failed to open browser."),Xe(`http://${r.develop.host}:${r.develop.port}${r.path?r.path:""}`)}:void 0,devMiddleware:{publicPath:r.path,stats:r.develop.stats==="normal"?!1:void 0},historyApiFallback:{index:r.path,disableDotRule:!0},hot:!0,allowedHosts:r.develop.allowedHosts?r.develop.allowedHosts:"auto"},v=new Qe(c,u);await s(async()=>{l.info(`Started development server on http://${r.develop.host}:${r.develop.port}${r.path?r.path:""}`),await v.start()},"runServer")(),await K(e,n,o)}s(he,"develop");export{q as ALIASED_PACKAGES,de as build,pe as clean,he as develop,W as findAllValidRoutes,D as findAllValidSettings,I as findAllValidWidgets,N as forbiddenRoutes,V as injectionZones,l as logger,y as normalizePath,ce as withCustomWebpackConfig};
//# sourceMappingURL=index.mjs.map